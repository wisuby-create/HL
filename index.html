<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Heartline</title>
<style>
  :root{
    --bg:#0d1420;
    --panel:#101826;
    --glass: rgba(255,255,255,.9);
    --card: #ffffff;
    --ink:#101214;
    --ink-2:#475569;
    --primary:#ff7aa2;
    --primary-2:#ff96b6;
    --radius:20px;
    --shadow: 0 10px 30px rgba(0,0,0,.15);
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Arial, "Apple Color Emoji", "Segoe UI Emoji";}
  /* rama telefonu */
  .phone{max-width:420px;margin:0 auto;background:#f6f7fb;border-radius:36px;padding:0;min-height:100dvh;box-sizing:border-box;position:relative;overflow:hidden}
  .status{height:54px;background:#0f172a;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;letter-spacing:.02em;position:sticky;top:0;z-index:5}
  .screen{min-height:calc(100dvh - 54px);background:#f7f3f6;}
  .wrap{max-width:560px;margin:0 auto;padding:18px}

  /* Start */
  .start-card{margin:16px;border-radius:28px;overflow:hidden;box-shadow:var(--shadow);background:#fff;position:relative}
  .start-card img{display:block;width:100%;height:auto}
  .start-cta{position:absolute;left:50%;transform:translateX(-50%);bottom:18px;background:var(--primary);color:#fff;border:none;border-radius:26px;padding:14px 22px;font-weight:800;box-shadow:0 8px 24px rgba(255,122,162,.35)}

  /* Modal name */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.35);z-index:20}
  .modal .card{background:#fff;border-radius:18px;box-shadow:var(--shadow);padding:20px;max-width:360px;width:calc(100% - 32px)}
  .modal label{display:block;margin:0 0 8px;font-weight:800}
  .modal input{width:100%;padding:12px;border-radius:12px;border:1px solid #e2e8f0;font-size:16px}
  .modal .row{display:flex;gap:12px;justify-content:flex-end;margin-top:14px}
  .btn{border:none;border-radius:14px;padding:10px 16px;font-weight:700}
  .btn.primary{background:var(--primary);color:#fff}
  .btn.ghost{background:#f1f5f9;color:#0f172a}

  /* Home */
  .home{min-height:calc(100dvh - 54px);background:var(--wall, #f9e7ef) center/cover no-repeat;position:relative}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
  .app{background:#fff;border:none;border-radius:18px;padding:16px;box-shadow:var(--shadow);display:flex;flex-direction:column;align-items:center;gap:8px}
  .app .ico{font-size:28px}
  .app .lbl{font-weight:800}
  .badge{position:absolute;right:-2px;top:-2px;background:#ef4444;color:#fff;border-radius:999px;font-size:12px;padding:2px 6px;font-weight:800}

  /* Notif bar */
  .notif{position:absolute;left:16px;right:16px;bottom:16px;background:rgba(255,255,255,.9);backdrop-filter: blur(6px);border-radius:16px;padding:10px 12px;box-shadow:var(--shadow);display:none}
  .notif strong{font-weight:800}

  /* Messages list */
  .tile{background:#fff;border-radius:18px;box-shadow:var(--shadow);padding:14px;display:flex;gap:12px;align-items:center}
  .list{display:flex;flex-direction:column;gap:12px}
  .avatar{width:44px;height:44px;border-radius:999px;display:inline-block;flex:0 0 44px;background:#e2e8f0;position:relative;overflow:hidden}
  .avatar img{width:100%;height:100%;object-fit:cover}
  .title{font-weight:900}
  .muted{color:#64748b}

  /* Chat */
  .chat{display:flex;flex-direction:column;gap:10px}
  .bubble{max-width:82%;padding:12px 14px;border-radius:16px;box-shadow:var(--shadow);background:#fff}
  .bubble.me{align-self:flex-end;background:linear-gradient(45deg,var(--primary),var(--primary-2));color:#fff}
  .choices{display:flex;flex-direction:column;gap:10px;margin-top:8px}
  .choice{border:none;border-radius:999px;padding:12px 16px;background:var(--primary);color:#fff;font-weight:800;box-shadow:0 8px 24px rgba(255,122,162,.35)}
  .next{align-self:flex-end;border:none;border-radius:999px;padding:10px 16px;background:#0ea5e9;color:#fff;font-weight:800}

  /* header wewn. ekran√≥w */
  .bar{display:flex;align-items:center;gap:10px;margin:8px 0 14px}
  .bar button{border:none;background:#f1f5f9;border-radius:10px;padding:8px 10px}
  .bar h2{margin:0;font-weight:900}
</style>
</head>
<body>
  <div class="phone" id="phoneRoot">
    <div class="status">Heartline</div>

    <!-- ===== START ===== -->
    <section class="screen" id="scrStart">
      <div class="start-card" id="startCard">
        <img id="startImg" alt="Heartline" />
        <button class="start-cta" id="btnStart">Start üí¨</button>
      </div>
    </section>

    <!-- ===== HOME (telefon) ===== -->
    <section class="screen home" id="scrHome" style="display:none">
      <div class="wrap">
        <div class="grid">
          <button class="app" data-open="messages">
            <div class="ico">üí¨</div>
            <div class="lbl">Messages</div>
            <span class="badge" id="badgeMessages" style="display:none">1</span>
          </button>
          <button class="app"><div class="ico">üìû</div><div class="lbl">Phone</div></button>
          <button class="app"><div class="ico">üñºÔ∏è</div><div class="lbl">Gallery</div></button>
          <button class="app"><div class="ico">‚è∞</div><div class="lbl">Clock</div></button>
          <button class="app"><div class="ico">üìù</div><div class="lbl">Notes</div></button>
          <button class="app" data-open="settings"><div class="ico">‚öôÔ∏è</div><div class="lbl">Settings</div></button>
        </div>
      </div>
      <div class="notif" id="homeNotif"></div>
    </section>

    <!-- ===== MESSAGES LIST ===== -->
    <section class="screen" id="scrMessages" style="display:none">
      <div class="wrap">
        <div class="bar">
          <button data-back="home">‚Üê</button>
          <h2>Messages</h2>
        </div>
        <div class="list" id="threads"></div>
      </div>
    </section>

    <!-- ===== CHAT ===== -->
    <section class="screen" id="scrChat" style="display:none">
      <div class="wrap">
        <div class="bar">
          <button data-back="messages">‚Üê</button>
          <h2 id="chatTitle">Chat</h2>
        </div>
        <div class="chat" id="chatList"></div>
      </div>
    </section>

    <!-- ===== MODAL NAME ===== -->
    <div class="modal" id="nameModal">
      <div class="card">
        <label for="nameInput">Enter your name</label>
        <input id="nameInput" placeholder="Type your name‚Ä¶" />
        <div class="row">
          <button class="btn ghost" id="nameCancel" style="display:none">Cancel</button>
          <button class="btn primary" id="nameOk">OK</button>
        </div>
      </div>
    </div>
  </div>

<script>

const ASSETS = {
  START_IMAGE: 'assets/start-cover.jpg', 
  WALLPAPER:   'assets/sakura-closeup.jpg',    
  AVATARS: {                               
    maya:   'assets/maya.png',
    riven:  'assets/riven.png',
    noah:   'assets/noah.png',
    victor: 'assets/victor.png'
  }
};
/* ================ STAN ================ */
const ST = JSON.parse(localStorage.getItem('HL_STATE')||'{}');
if(!ST.playerName) ST.playerName='';
if(!ST.contacts) ST.contacts={
  maya:{ id:'maya', name:'Maya',   avatar:ASSETS.AVATARS.maya,   unlocked:true,  preview:'' },
  riven:{id:'riven',name:'Riven',  avatar:ASSETS.AVATARS.riven,  unlocked:false, preview:'Locked' },
  noah:{ id:'noah', name:'Noah',   avatar:ASSETS.AVATARS.noah,   unlocked:false, preview:'Locked' },
  victor:{id:'victor',name:'Victor',avatar:ASSETS.AVATARS.victor,unlocked:false, preview:'Locked' }
};
if(!ST.threads) ST.threads={  // historia czat√≥w
  maya:[],
  riven:[],
  noah:[],
  victor:[]
};
if(!ST.unread) ST.unread={};
save();

/* ================ POMOCNICZE ================ */
function qs(s,root=document){return root.querySelector(s)}
function qsa(s,root=document){return [...root.querySelectorAll(s)]}
function save(){ localStorage.setItem('HL_STATE', JSON.stringify(ST)); }
function clearUnread(id){ delete ST.unread[id]; save(); renderBadges(); }
function renderBadges(){
  const n = Object.keys(ST.unread).length;
  qs('#badgeMessages').style.display = n? 'inline-block':'none';
}

/* ================ EKRANY ================ */
const scrStart = qs('#scrStart');
const scrHome  = qs('#scrHome');
const scrMessages = qs('#scrMessages');
const scrChat = qs('#scrChat');
const chatList = qs('#chatList');
const chatTitle = qs('#chatTitle');

function show(screen){
  [scrStart,scrHome,scrMessages,scrChat].forEach(s=>s.style.display='none');
  screen.style.display='block';
  if(screen===scrHome) renderHome();
  if(screen===scrMessages) renderThreads();
}

function renderHome(){
  // tapeta
  scrHome.style.setProperty('--wall', `url("${ASSETS.WALLPAPER}")`);
  // powiadomienie (je≈õli sƒÖ nieprzeczytane)
  const notif = qs('#homeNotif');
  const unreadIds = Object.keys(ST.unread);
  if(unreadIds.length){
    const id = unreadIds[0];
    notif.innerHTML = `<strong>New message from ${ST.contacts[id].name}</strong> üí¨`;
    notif.style.display='block';
    notif.onclick=()=>{ show(scrMessages); };
  } else {
    notif.style.display='none';
  }
}

function renderThreads(){
  const box = qs('#threads');
  box.innerHTML='';
  for(const id of ['maya','riven','noah','victor']){
    const c = ST.contacts[id];
    const last = ST.threads[id].length ? ST.threads[id][ST.threads[id].length-1].text : (c.preview||'');
    const tile = document.createElement('button');
    tile.className='tile';
    tile.style.width='100%';
    tile.style.textAlign='left';
    tile.disabled = !c.unlocked;
    tile.dataset.openThread = id;

    const av = document.createElement('span'); av.className='avatar';
    if(c.avatar) av.innerHTML = `<img src="${c.avatar}" alt="${c.name}">`;
    const wrap = document.createElement('div');
    wrap.innerHTML = `<div class="title">${c.name}</div><div class="muted">${last||''}</div>`;

    tile.append(av,wrap);
    if(ST.unread[id]){ const b=document.createElement('span'); b.className='badge'; b.textContent='1'; b.style.position='static'; b.style.marginLeft='auto'; tile.append(b); }
    box.append(tile);
  }
}

/* ================ CHAT ================ */
let currentThread = null;

function openThread(id){
  currentThread = id;
  clearUnread(id);
  chatTitle.textContent = ST.contacts[id].name;
  renderChat();
  show(scrChat);
}
function renderChat(){
  chatList.innerHTML='';
  const items = ST.threads[currentThread];
  for(const it of items){
    const b = document.createElement('div');
    b.className = 'bubble ' + (it.from==='me' ? 'me' : '');
    b.textContent = it.text;
    chatList.append(b);
  }
}
function pushMsg(id, from, text){
  ST.threads[id].push({from, text});
  save();
  if(currentThread===id) renderChat(); else ST.unread[id]=true, save(), renderBadges();
}

/* ================ LOGIKA STARTU ================ */
function boot(){
  // obrazek startu
  const img = qs('#startImg');
  img.src = ASSETS.START_IMAGE;
  // przyciski
  qs('#btnStart').onclick = ()=> askName();
  // Back/otwieranie ekran√≥w
  qsa('[data-back]').forEach(b=>b.onclick=()=>show(b.dataset.back==='home'?scrHome:scrMessages));
  qsa('[data-open]').forEach(b=>{
    if(b.dataset.open==='messages') b.onclick=()=>show(scrMessages);
    if(b.dataset.open==='settings') b.onclick=()=>alert('Settings (coming soon)');
  });
  // klik tile ‚Üí chat
  qs('#threads').addEventListener('click',e=>{
    const btn = e.target.closest('[data-open-thread]');
    if(!btn) return;
    const id = btn.dataset.openThread;
    if(ST.contacts[id].unlocked) openThread(id);
  });

  // je≈õli nie ma imienia ‚Üí popro≈õ i dopiero poka≈º home
  if(!ST.playerName){ show(scrStart); }
  else { show(scrHome); scheduleIntro(); }
}
function askName(){
  const modal = qs('#nameModal');
  modal.style.display='flex';
  const inp = qs('#nameInput');
  inp.value = ST.playerName||'';
  inp.focus();
  const ok = qs('#nameOk');
  ok.onclick = ()=>{
    const v = inp.value.trim()||'You';
    ST.playerName = v; save();
    modal.style.display='none';
    show(scrHome);
    scheduleIntro(); // uruchom scenƒô 1
  };
}

/* ================ SCENA 1: Maya ‚Üí Riven ‚Üí Maya (szkielet) ================ */
function scheduleIntro(){
  // je≈õli ju≈º odpalone wcze≈õniej ‚Äî nic nie r√≥b
  if(ST._introDone) return;
  ST._introDone = true; save();

  // 1) po kr√≥tkiej pauzie przychodzi Maya
  setTimeout(()=>{
    ST.contacts.maya.preview = "Hey! Guess who texted me just now? üëÄ";
    pushMsg('maya','maya',`Hey ${ST.playerName}! Guess who texted me last night? üëÄ`);
  }, 700);

  // 2) po wej≈õciu do Mai sƒÖ 3 odpowiedzi ‚Üí poka≈ºemy sekwencyjnie
  // (Tu tylko fundament ‚Äì wybory dok≈Çadamy p√≥≈∫niej w pliku story)
}

/* ====== Init ====== */
boot();

/* ====== DEBUG pomoc ====== */
window.HL = {
  reset(){ localStorage.removeItem('HL_STATE'); location.reload(); },
  notify(id='maya', text='Ping!'){ ST.contacts[id].preview=text; pushMsg(id,id,text); }
};
</script>
</body>
</html>
